!function(t){var e={};function o(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(s,r,function(e){return t[e]}.bind(null,r));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=1)}([function(t,e,o){},function(t,e,o){"use strict";o.r(e);class s{constructor(){this.canvasDraw=document.querySelector(".display-canvas"),this.draftCanvas=document.querySelector(".draft-canvas"),this.sizesWrap=document.querySelector(".canvas-sizes"),this.gayscaleBtn=document.querySelector(".btn_grayscale"),this.listeners(),this.tool=null,this.color=null,this.line=1,this.startX=null,this.startY=null,this.imgSave=null,this.resizeImgSave=null}listeners(){this.canvasDraw.addEventListener("mousedown",t=>{"pencil-tool"===this.tool&&this.pencil(t),"bucket-tool"===this.tool&&this.bucketTool(t)}),this.canvasDraw.addEventListener("mouseup",()=>{this.imgSave=this.canvasDraw.toDataURL()}),this.sizesWrap.addEventListener("click",t=>{if(t.target.classList.contains("btn_size")){const e=t.target.dataset.size,o=t.target.dataset.pen;this.line=+o,this.imgSave&&this.reDrawCanvas(e)}}),this.gayscaleBtn.addEventListener("click",()=>{this.imgSave&&this.grayscaleConvert()})}grayscaleConvert(){const t=this.canvasDraw,e=t.getContext("2d"),o=e.getImageData(0,0,t.width,t.height),r=e.createImageData(t.width,t.height),a=o.data,i=r.data;for(let t=0;t<a.length;t+=4){const e=.2126*a[t]+.7152*a[t+1]+.0722*a[t+2];i[t]=e,i[t+1]=e,i[t+2]=e,i[t+3]=a[t+3]}s.clearCanvas(),e.putImageData(r,0,0)}reDrawCanvas(t){const e=this.canvasDraw.getContext("2d"),o=this.draftCanvas,r=o.getContext("2d"),a=new Image;a.src=this.imgSave,o.width=t,o.height=t;const i=()=>{r.drawImage(a,0,0,t,t),this.resizeImgSave=o.toDataURL();const i=new Image;i.src=this.resizeImgSave;i.addEventListener("load",()=>{s.clearCanvas(),e.imageSmoothingEnabled=!1,e.drawImage(i,0,0,512,512)})};a.addEventListener("load",()=>{i()})}drawImage(t,e){s.clearCanvas();const o=e,r=this.canvasDraw,a=r.getContext("2d"),i=t;if(o.width>r.width||o.height>r.height){const t=i/(o.width>o.height?o.width:o.height);o.width*=t,o.height*=t}const n=(i-o.width)/2,c=(i-o.height)/2;a.drawImage(o,n,c,o.width,o.height),this.imgSave=this.canvasDraw.toDataURL()}getCoordinate(t){const e=this.canvasDraw,o=t.pageX-e.offsetLeft,s=t.pageY-e.offsetTop;return{dotX:o-o%this.line,dotY:s-s%this.line}}pencil(t){const e=this.canvasDraw.getContext("2d");e.fillStyle=this.color;(t=>{const o=this.getCoordinate(t);this.startX=o.dotX,this.startY=o.dotY,e.fillRect(o.dotX,o.dotY,this.line,this.line)})(t);const o=this.bresenham.bind(this),s=()=>{this.canvasDraw.removeEventListener("mousemove",o),document.removeEventListener("mouseup",s)};this.canvasDraw.addEventListener("mousemove",o),document.addEventListener("mouseup",s)}bresenham(t){const e=this.canvasDraw.getContext("2d");e.fillStyle=this.color;const o=this.line,s=this.getCoordinate(t);let r=s.dotX-this.startX,a=s.dotY-this.startY;const i=Math.abs(r/o),n=Math.abs(a/o);let c=this.startX,l=this.startY;const h=+o;r=r>0?h:-h,a=a>0?h:-h;let d=Math.abs(s.dotY-this.startY)/Math.abs(s.dotX-this.startX),u=i;i<n&&(u=n,d=Math.abs(s.dotX-this.startX)/Math.abs(s.dotY-this.startY)),d-=Math.trunc(d);let v=0;if(i>=n)for(let t=0;t<u;t+=1)if(c+=r,(v+=d)>=.5&&(l+=a,v-=1),"eraser"===this.tool){const t={pointX:c,pointY:l};this.eraserTool(t)}else e.fillRect(c,l,o,o);else for(let t=0;t<u;t+=1)if(l+=a,(v+=d)>=.5&&(c+=r,v-=1),"eraser"===this.tool){const t={pointX:c,pointY:l};this.eraserTool(t)}else e.fillRect(c,l,o,o);this.startX=c,this.startY=l}bucketTool(t){const e=this.line,o=this.canvasDraw,s=o.getContext("2d");s.fillStyle=this.color;let r=t.pageX-o.offsetLeft,a=t.pageY-o.offsetTop;const i=s.getImageData(r,a,1,1).data.join("");if(s.getImageData(r,a,1,1).data.join(", ")===`${this.color.slice(4,-1)}, 255`)return;const n=[[r-=r%e,a-=a%e]],c=(t,e)=>{const o=t,r=e;return s.getImageData(o,r,1,1).data.join("")===i};for(;n.length;){const t=n.pop(),r=t[0];let a=t[1];do{a-=e}while(a>=0&&c(r,a));a+=e;let i=!1,d=!1;do{l=r,h=a,s.fillRect(l,h,e,e),r<o.width&&(c(r+e,a)?i||(n.push([r+e,a]),i=!0):i&&(i=!1)),r>0&&(c(r-e,a)?d||(n.push([r-e,a]),d=!0):d&&(d=!1)),a+=e}while(c(r,a)&&a!==o.height)}var l,h}colorPicker(t){const e=t.pageX-this.canvasDraw.offsetLeft,o=t.pageY-this.canvasDraw.offsetTop;return this.canvasDraw.getContext("2d").getImageData(e,o,1,1).data}static clearCanvas(){const t=document.querySelector("canvas");t.getContext("2d").clearRect(0,0,t.width,t.height)}static grabImg(){return document.querySelector("canvas").toDataURL()}static putCanvas(t){const e=document.querySelector("canvas").getContext("2d"),o=new Image;o.onload=()=>{e.drawImage(o,0,0)},o.src=t}}class r{constructor(t){this.canvas=t,this.canvasElem=document.querySelector("canvas"),this.controlPanel=document.querySelector(".control-panel-wrapper"),this.tools=document.querySelector(".tools-wrapper ul"),this.palette=document.querySelector(".palette-wrapper"),this.pencil=document.querySelector(".pencil-tool"),this.bucket=document.querySelector(".bucket-tool"),this.colorPicker=document.querySelector(".choose-tool"),this.currentColorElem=document.querySelector(".color-view_cur input"),this.prevColorElem=document.querySelector(".color-view_prev"),this.clear=document.querySelector(".btn_clear"),this.requestField=document.querySelector(".request-field"),this.currentTool=this.pencil,this.currentColor="#008800",this.prevColor="#ffbb00",this.isPickColor=0,this.chooseColor()}logic(){this.tools.addEventListener("click",t=>{t.target.closest("li")&&this.markActiveTool(t.target)}),this.palette.addEventListener("click",t=>{if(t.target.closest("li")){const e=t.target.closest("li").querySelector(".color-view");e.classList.contains("color-view_cur")||this.switchColors(e)}}),this.palette.addEventListener("change",()=>{this.currentColor=this.currentColorElem.value,this.currentColorElem.style.backgroundColor=this.currentColorElem.value,this.canvas.color=this.currentColorElem.style.backgroundColor});const t=t=>{"KeyP"===t.code?this.markActiveTool(this.pencil):"KeyC"===t.code?this.markActiveTool(this.colorPicker):"KeyB"===t.code&&this.markActiveTool(this.bucket)};document.addEventListener("keydown",t),this.requestField.addEventListener("focus",()=>{document.removeEventListener("keydown",t)}),this.requestField.addEventListener("blur",()=>{document.addEventListener("keydown",t)}),this.clear.addEventListener("click",s.clearCanvas),document.addEventListener("selectstart",t=>{t.preventDefault()})}markActiveTool(t){const e=t;this.currentTool.classList.remove("active-tool"),e.classList.add("active-tool"),this.currentTool=e,this.setActiveTool(e)}setActiveTool(t){const e=t.closest("li").classList[0];this.canvas.tool=e,this.isPickColor="choose-tool"===e?1:0}setActiveColor(t){this.currentColorElem.value=t,this.prevColorElem.style.backgroundColor=this.prevColor,this.currentColor=t,this.currentColorElem.style.backgroundColor=t,this.canvas.color=this.currentColorElem.style.backgroundColor}switchColors(t){const e=getComputedStyle(t).backgroundColor,o=r.convertBaseColor(e);this.currentColorElem.value=o,this.prevColorElem.style.backgroundColor=this.currentColor,this.prevColor=this.currentColor,this.currentColor=o,this.canvas.color=e}chooseColor(){this.canvasElem.addEventListener("click",t=>{if(this.isPickColor){const e=this.canvas.colorPicker(t),o=r.convertBaseColor(e);this.prevColor=this.currentColor,this.setActiveColor(o)}})}static convertBaseColor(t){let e=t,o="";return"string"==typeof e&&(e=e.slice(4,-1).split(",")),e.forEach((t,e)=>{if(3===e)return;let s=t;"string"==typeof s&&(s=+s);let r=s.toString(16);r="0"===r?"00":String(r),o+=r}),o="000000"===o?"#ffffff":`#${o}`}}class a{constructor(){this.errorPosition=document.querySelector(".loader-control")}badAnswer(t){const e=document.createElement("div"),o=document.createElement("div"),s=document.createElement("p");e.classList.add("modal-error"),o.classList.add("modal-close-btn"),o.innerHTML="&times;",s.innerHTML=t,e.append(o,s),this.errorPosition.append(e),o.addEventListener("click",()=>{e.hidden=!0})}}o(0);const i=new s;new class{constructor(t){this.control=new r(t),this.canvas=t,this.localStore={}}logic(){const t=this.control,e=this.localStore;if(localStorage.getItem("storePalette")){t.logic();const e=JSON.parse(localStorage.getItem("storePalette"));s.putCanvas(e.canvasImg);const o=document.querySelector(`.${e.activeTool}`);t.markActiveTool(o),t.currentColor=e.currentColor,t.prevColor=e.prevColor,t.setActiveColor(t.currentColor),this.canvas.line=e.lineFat,this.canvas.imgSave=e.imgSave}else t.logic(),t.markActiveTool(t.currentTool),t.setActiveColor(t.currentColor);window.addEventListener("beforeunload",()=>{e.canvasImg=s.grabImg();const o=t.currentTool.classList[0];e.activeTool=o,e.currentColor=t.currentColor,e.prevColor=t.prevColor,e.lineFat=this.canvas.line,e.imgSave=this.canvas.imgSave;const r=JSON.stringify(e);localStorage.setItem("storePalette",r)})}}(i).logic(),new class{constructor(t){this.canvas=t,this.error=new a,this.requestURL="https://api.unsplash.com/photos/random?client_id=76e02e7b52a90f9aeedee595901a91ad8a6e98072539f05ba2420e24b6a4fa75&query=town,",this.loadBtn=document.querySelector(".btn_load"),this.requestField=document.querySelector(".request-field")}logic(){this.loadBtn.addEventListener("click",()=>{this.getData(),this.canvas.line=1})}async getData(){let t=this.requestURL;const e=this.requestField.value;if(e){t=`${t}${e}`;try{const e=await fetch(t);if(!e.ok)throw new Error("Unfortunately we didn't get correct answer from the server");{const t=await e.json();this.imgPrepare(t.urls.small)}}catch(t){this.error.badAnswer(t.message)}}}imgPrepare(t){const e=new Image;e.crossOrigin="Anonymous",e.src=t;e.addEventListener("load",()=>{this.canvas.drawImage(512,e)})}}(i).logic()}]);
//# sourceMappingURL=app.bundle.js.map